name: pages-dev-ban
on:
  pull_request:
jobs:
  ban-pages-dev:
    if: ${{ vars.ENABLE_LEGACY_POLICY_GUARDS == 'true' }}
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Fail on pages.dev or wrangler pages references in code
        run: |
          set -euo pipefail
          dirs=(src scripts packages .github)
          hits=""
          for d in "${dirs[@]}"; do
            if [ -d "$d" ]; then
              part=$(grep -RInE "pages\.dev|wrangler pages" "$d" || true)
              hits="$hits$part\n"
            fi
          done
          if [ -n "$(echo "$hits" | sed '/^$/d')" ]; then
            echo -e "Found disallowed references in code paths:\n$hits" >&2
            exit 1
          fi
          echo "No disallowed references found in code paths."
