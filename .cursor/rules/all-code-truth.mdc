---
scope: ["**/*"]
enforce: true
---
# All Code Truth

## Documentation Truth
- **System Truth**: `docs/all-system-truth.md` - Entry point, script manifest, and golden path.
- **Git Truth**: `docs/all-git-truth.md` - Git operations, pre-commit hooks, MD governance.
- **Deployment Truth**: `docs/all-deployment-truth.md` - Preview/staging operations, URL verification.
- **Local Dev Truth**: `docs/all-local-dev-truth.md` - Ports, remote bindings, troubleshooting.

## Script Truth  
- **Git Operations**: `scripts/all-git-truth.sh` - Unified git wrapper and pre-commit hook.
- **Deployment**: `scripts/deploy-module.sh` - Master script for single-module deployment.
- **Preview**: `scripts/deploy-preview.sh` - Wrapper to deploy all modules to preview.
- **Validation**: `scripts/validation/run-validation.sh` - Automated deployment testing suite.

## Supporting Guides
- `docs/operational-runbook.md` - Monitoring, incident response, secrets.
- `docs/secrets-management.md` - Secret rotation, bindings, bootstrap.
- `docs/shopify-oauth-setup.md` - OAuth configuration for App module.
- `docs/zero-trust/support-bundle.md` - Support ticket templates.

## File Naming Convention (ENFORCED)
- **Lowercase only**: no uppercase letters allowed
- **Hyphen-separated**: use hyphens, not underscores
- **"all-" prefix**: reserved for truth/index files only
- **Examples**: 
  - ✅ `all-git-truth.md`, `deploy-module.sh`, `api-helpers.ts`
  - ❌ `Deploy_Module.sh`, `API-HELPERS.ts`, `Quick-Fix-GUIDE.md`

## MD File Creation Rules

### Placement
- **Documentation**: `docs/` or domain-specific subdirectories (e.g., `docs/zero-trust/`)
- **Truth Files**: `docs/all-<domain>-truth.md`
- **Archives**: `docs/archive/` (never delete, always archive)

### Required Headers (Templates)

**1. Truth File Template** (`docs/all-*-truth.md`)
```markdown
# <Domain> Truth

**Last Updated**: YYYY-MM-DD  
**Rule Reference**: `.cursor/rules/all-code-truth.mdc`  
**Related**: `docs/all-system-truth.md`
```

**2. Supporting Guide Template** (`docs/operational-runbook.md`, etc.)
```markdown
# <Guide Title>

**Last Updated**: YYYY-MM-DD  
**Rule Reference**: `.cursor/rules/all-code-truth.mdc`  
**Canonical Source**: `docs/all-<domain>-truth.md`
```

**3. Archive Header**
```markdown
# [Original Title]

**DEPRECATED**: This file has been consolidated.  
**See**: `docs/all-<domain>-truth.md`

**Migration Date**: YYYY-MM-DD
**Archived On**: YYYY-MM-DD HH:MM:SS

---
```

### Interlinking
- Every MD file must reference `.cursor/rules/all-code-truth.mdc`
- Domain-specific files must reference their `all-<domain>-truth.md`
- Truth files must reference each other where relevant

### Grouping
- **Domain Truth**: One `all-<domain>-truth.md` per major area (Git, Deployment, API)
- **Child Files**: Specific guides link UP to the domain truth file
- **Index**: `docs/all-system-truth.md` lists all truth files

### Archiving Protocol
When deprecating a file:
1. Move to `docs/archive/` (or `scripts/archive/`)
2. Add redirect header with deprecation timestamp.

## Plan File Rules
- **Location**: All new plans must be created under `docs/plans/`.
- **Naming**: Use user-provided filename (lowercase, hyphen-separated).
- **Prohibited**: 
  - Never create or use `one.plan.md`.
  - Do not write plans to repository root or `.cursor/`.
- **Correction**: If a plan is accidentally generated elsewhere, move it to `docs/plans/<name>.md` immediately.

## MDC (Rule) File Creation Rules

### Placement
- **Location**: `.cursor/rules/`
- **Extension**: `.mdc`

### Naming
- **Format**: `all-<domain>-truth.mdc` (for consolidated rules) or `<specific-rule>.mdc`
- **Convention**: Lowercase, hyphen-separated

### Structure
- **Frontmatter**: Must include `scope` and `enforce` fields
- **Content**: Clear, actionable rules (no fluff)
- **References**: Must link to corresponding `docs/all-<domain>-truth.md`

## Deprecated Patterns (BANNED)
- `one.plan.md` - never create or use
- Uppercase in filenames - convert to lowercase
- Underscore separators - convert to hyphens (except DB migrations)
- Multiple truth files per domain - consolidate to one
- **Pages.dev**: Do not introduce `pages.dev` references or `wrangler pages` commands. Prefer staging subdomains (`staging-apex|app|admin.cloudcache.ai`).
